(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{2805:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return _}});var r=n(5893),i=n(4121),a=n(1120),o=n(1749),u=n(7294),c=n(9999),s=n(6265),f=n(6084),l=(0,u.createContext)({farmingData:null,setFarmingData:function(){},requiredItems:null,setRequiredItems:function(){},farmingPlan:null,setFarmingPlan:function(){}});function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var p=(0,a.Z)({root:{height:300}}),d=function(){var e=u.useContext(l),t=e.farmingData,n=e.farmingPlan,i=p();if(!t||!n)return null;var a=n.map((function(e,t){var n=e.farmingStage,r=e.count,i=n.cost*r,a=Object.fromEntries(n.itemDrops.map((function(e){var t=e.name,n=e.probability;return[t,Math.floor(n*r)]})));return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({id:t,name:n.name,count:r,totalCost:i},a)})),o=new Set;n.forEach((function(e){e.farmingStage.itemDrops.forEach((function(e){var t=e.name;return o.add(t)}))}));var d=t.items.filter((function(e){var t=e.name;return o.has(t)})).map((function(e){return e.name})),g=[{field:"name",headerName:"\u5468\u56de\u30b9\u30c6\u30fc\u30b8",width:200},{field:"count",headerName:"\u56de\u6570",type:"number",width:100},{field:"totalCost",headerName:"\u7dcf\u30b3\u30b9\u30c8",type:"number",width:150}].concat((0,c.Z)(d.map((function(e){return{field:e,headerName:e,type:"number",width:150}}))));return(0,r.jsx)("div",{className:i.root,children:(0,r.jsx)(f._$r,{rows:a,columns:g,disableColumnMenu:!0})})},g=n(809),h=n.n(g),v=n(2447),b=n(8463),j=n(9912),O=n(282),y=n(2318),w=function(e){return function(e){return{farmingStages:(n=e.farmingStages,n.map((function(e){return{name:e.name,cost:e.cost,itemDrops:e.itemDrops.map((function(e){return{name:e.name,probability:e.probability}}))}}))),items:(t=e.items,t.sort((function(e,t){return e.id-t.id})))};var t,n}(JSON.parse(e))},x=function(){var e=u.useState(""),t=(0,i.Z)(e,2),n=t[0],a=t[1],c=u.useContext(l),s=c.setFarmingData,f=c.setRequiredItems,m=c.setFarmingPlan,p=function(){var e=(0,v.Z)(h().mark((function e(t){var n,r;return h().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.target.files){e.next=2;break}return e.abrupt("return");case 2:return a(t.target.files[0].name),e.next=5,t.target.files[0].text();case 5:n=e.sent,r=w(n),s(r),f(r.items.map((function(e){return{name:e.name,count:0}}))),m(null);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,r.jsx)(b.Z,{children:(0,r.jsx)(j.Z,{children:(0,r.jsxs)(o.Z,{container:!0,alignItems:"center",spacing:2,children:[(0,r.jsx)(o.Z,{item:!0,children:(0,r.jsxs)(O.Z,{variant:"contained",component:"label",children:["Select JSON",(0,r.jsx)("input",{type:"file",accept:"application/json",hidden:!0,onChange:p})]})}),(0,r.jsx)(o.Z,{item:!0,children:(0,r.jsx)(y.Z,{variant:"body1",children:n})})]})})})},P=function(e,t){for(var n=function(e){var t=new Map;return e.forEach((function(e){var n=e.itemDrops,r=e.cost;n.forEach((function(n){var i,a=n.name,o=n.probability,u=(null===(i=t.get(a))||void 0===i?void 0:i.cost)||1/0,c=r/o;c<u&&t.set(a,{name:a,farmingStage:e,cost:c})}))})),t}(e),r=[],a=new Map(t.filter((function(e){return e.count})).map((function(e){return[e.name,e.count]}))),o=function(){var t=Array.from(a.entries()).map((function(e){var t=(0,i.Z)(e,2);return{name:t[0],count:t[1]}})),o=function(e,t,n){var r=t.filter((function(e){return e.count})).map((function(e){return e.name}));return e.map((function(e){var t=e.cost;return{farmingStage:e,score:e.itemDrops.map((function(e){var t,i=e.name,a=e.probability;return r.includes(i)?((null===(t=n.get(i))||void 0===t?void 0:t.cost)||0)*a:0})).reduce((function(e,t){return e+t}))/t}}))}(e,t,n).reduce((function(e,t){return e.score>=t.score?e:t})).farmingStage,u=o.itemDrops.map((function(e){var t=e.name,n=e.probability,r=a.get(t)||0;return Math.ceil(r/n)})).filter((function(e){return e>0}));if(0===u.length)throw new Error("\u5468\u56de\u3067\u306f\u53ce\u96c6\u4e0d\u53ef\u80fd");var s=Math.min.apply(Math,(0,c.Z)(u));r.push({farmingStage:o,count:s}),o.itemDrops.forEach((function(e){var t=e.name,n=e.probability,r=a.get(t),i=r?r-Math.floor(s*n):0;i<=0?a.delete(t):a.set(t,i)}))};a.size>0;)o();return r},Z=function(){var e=u.useContext(l),t=e.farmingData,n=e.requiredItems,i=e.setFarmingPlan;return(0,r.jsx)(O.Z,{variant:"contained",disabled:!t||!n,onClick:function(){t&&n&&i(P(null===t||void 0===t?void 0:t.farmingStages,n))},children:"\u5468\u56de\u30d7\u30e9\u30f3\u751f\u6210"})};function D(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?D(Object(n),!0).forEach((function(t){(0,s.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):D(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var E=(0,a.Z)({root:{height:300}}),N=function(){var e=u.useContext(l),t=e.requiredItems,n=e.setRequiredItems,i=E();if(!t)return null;var a=t.map((function(e,t){return S({id:t},e)}));return(0,r.jsx)("div",{className:i.root,children:(0,r.jsx)(f._$r,{rows:a,columns:[{field:"name",headerName:"\u30a2\u30a4\u30c6\u30e0\u540d",width:200},{field:"count",headerName:"\u5fc5\u8981\u6570",type:"number",editable:!0,width:100}],onCellEditCommit:function(e){var r,i=parseInt(e.id.toString()),a=parseInt((null===(r=e.value)||void 0===r?void 0:r.toString())||"0");n(t.map((function(e,t){return t===i?S(S({},e),{},{count:a}):e})))},disableColumnMenu:!0})})},C=(0,a.Z)({container:{padding:16}}),_=function(){var e=u.useState(null),t=(0,i.Z)(e,2),n=t[0],a=t[1],c=u.useState(null),s=(0,i.Z)(c,2),f=s[0],m=s[1],p=u.useState(null),g=(0,i.Z)(p,2),h={farmingData:n,setFarmingData:a,requiredItems:f,setRequiredItems:m,farmingPlan:g[0],setFarmingPlan:g[1]},v=C();return(0,r.jsx)(l.Provider,{value:h,children:(0,r.jsxs)(o.Z,{container:!0,spacing:2,direction:"column",className:v.container,children:[(0,r.jsx)(o.Z,{item:!0,children:(0,r.jsx)(x,{})}),n?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(o.Z,{item:!0,children:(0,r.jsx)(N,{})}),(0,r.jsx)(o.Z,{item:!0,children:(0,r.jsx)(Z,{})}),(0,r.jsx)(o.Z,{item:!0,children:(0,r.jsx)(d,{})})]}):null]})})}},5301:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(2805)}])}},function(e){e.O(0,[314,79,774,888,179],(function(){return t=5301,e(e.s=t);var t}));var t=e.O();_N_E=t}]);